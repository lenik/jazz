<?xml version="1.0"?>
<project name="net.bodz.bas" default="default">

    <property environment="env" />
    <property name="JAVA_LIB" value="${env.JAVA_LIB}" />
    <property file="${JAVA_LIB}/libraries.ini" prefix="lib" />

    <property name="distdir" value="${env.JAVA_LIB}" />
    <property name="distsrc" value="${env.JAVA_SRC}" />

    <path id="classpath">
        <path path="mod/_MODEL/bin" />
        <path path="mod/Application Framework/bin" />
        <path path="mod/B-IOS Framework/bin" />
        <path path="mod/Bundled Modules/bin" />
        <path path="mod/Data Types/bin" />
        <path path="mod/Database Abstraction/bin" />
        <path path="mod/Functional Programming/bin" />
        <path path="mod/Language Extension/bin" />
        <path path="mod/System Utilities/bin" />
        <path path="mod/Text Process/bin" />
        <path path="mod/Wrapper Classes/bin" />
    </path>

    <taskdef resource="net/bodz/bas/ant/task.properties" classpathref="classpath" />

    <target name="default" depends="dist">
    </target>

    <target name="dist" depends=":bin.jar, :src.jar">
        <copy todir="${distdir}">
            <fileset file="${basedir}/lib/*.jar">
                <exclude name="*-src.jar" />
            </fileset>
        </copy>
        <copy todir="${distsrc}">
            <fileset file="${basedir}/lib/*-src.jar" />
        </copy>
    </target>

    <target name=":bin.jar">
        <mkdir dir="lib" />
        <jar destfile="lib/net.bodz.bas.jar" update="true">
            <fileset dir="mod/_MODEL/bin" />
            <fileset dir="mod/Application Framework/bin" />
            <fileset dir="mod/B-IOS Framework/bin" />
            <fileset dir="mod/Bundled Modules/bin" />
            <fileset dir="mod/Data Types/bin" />
            <fileset dir="mod/Database Abstraction/bin" />
            <fileset dir="mod/Functional Programming/bin" />
            <fileset dir="mod/Language Extension/bin" />
            <fileset dir="mod/System Utilities/bin" />
            <fileset dir="mod/Text Process/bin" />
            <fileset dir="mod/Wrapper Classes/bin" />
        </jar>
        <length property="size.bin" file="lib/net.bodz.bas.jar" />
        <echo>Size: ${size.bin}</echo>
    </target>

    <target name=":src.jar">
        <mkdir dir="lib" />
        <jar destfile="lib/net.bodz.bas-src.jar" update="true">
            <fileset dir="mod/_MODEL/src" />
            <fileset dir="mod/Application Framework/src" />
            <fileset dir="mod/B-IOS Framework/src" />
            <fileset dir="mod/Bundled Modules/src" />
            <fileset dir="mod/Data Types/src" />
            <fileset dir="mod/Database Abstraction/src" />
            <fileset dir="mod/Functional Programming/src" />
            <fileset dir="mod/Language Extension/src" />
            <fileset dir="mod/System Utilities/src" />
            <fileset dir="mod/Text Process/src" />
            <fileset dir="mod/Wrapper Classes/src" />
        </jar>
        <length property="size.src" file="lib/net.bodz.bas-src.jar" />
        <echo>Size: ${size.src}</echo>
    </target>

    <target name="loadertest.jar">
        <mkdir dir="lib" />
        <jar destfile="lib/loadertest.jar">
            <fileset dir="mod/Application Framework/bin">
                <include name="net/bodz/bas/a/LoadBy.class" />
                <include name="net/bodz/bas/loader/BundledLoader.class" />
                <include name="net/bodz/bas/loader/LoaderTest.class" />
            </fileset>
        </jar>
    </target>

    <target name="testbats" depends=":bin.jar">
        <mkbat outdir="bin">
            <srcdir path="mod/Application Framework/bin" />
        </mkbat>
    </target>

    <target name="update-lib">
        <copy todir="${basedir}/lib">
            <fileset dir="${JAVA_LIB}">
                <include name="${lib.asm}" />
            </fileset>
        </copy>
    </target>

    <target name="clean">
        <delete verbose="true">
            <fileset dir="${basedir}/lib" includes="net.bodz.bas*.jar" />
        </delete>
    </target>

</project>
